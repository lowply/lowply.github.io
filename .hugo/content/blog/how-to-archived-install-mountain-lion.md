+++
categories = ["Daily"]
date = "2012-07-27T19:17:53+09:00"
draft = false
slug = "how-to-archived-install-mountain-lion"
title = "Mountain Lionをアーカイブインストールする"
+++

山ライオンがリリースされて「[クリーンインストールしよう](http://wayohoo.com/mac/tips/how-to-clean-install-os-x-mountain-lion.html)」みたいな記事をチラホラ見かけるようになったから、個人的にいつもやってる「アーカイブインストール」について書こうと思う。

これは何かというと、HDDをフォーマットせず、旧システムを別フォルダに突っ込んでからインストールを行う方法。Leopardまでは「アーカイブしてインストール」というオプションとして存在していたのに、Snow Leopardからなくなった。

#### クリーンインストールのデメリット

クリーンインストールはHDDをフォーマットするので、データが全部消える。そのため、通常は全データのバックアップを取ってから行う。けどこれが非常にめんどい。

例えば、iTunesやiPhotoなどの大きなデータがブートHDD上にある場合、HDDをフォーマットするクリーンインストールだと「データを外付けHDDに退避 → クリーンインストール → データを戻す」という作業が必要で、すごく時間がかかる。しかも、退避時にコピー忘れしたファイルはもう戻ってこない。

で、ちょっとターミナルを使えば、この「アーカイブしてインストール」を手動で行うことができる。

#### 手順1

まずはお決まりのBoot USBを、[ココらへん](https://www.google.co.jp/search?hl=ja&amp;q=install%20USB%20mountain%20lion&amp;qscrl=1)を参考にして適当に作り、そっから起動させる。ここでディスクユーティリティを使って起動ディスクのチェックなどをしてもいい。

#### 手順2

メニューの「ユーティリティ」から「ターミナル」を起動する。この状態では最初からroot（なんでもできるスーパーユーザー）になっているので、ターミナル上で以下のコマンドを打つ。

```bash
$ cd /Volumes/Macintosh\ HD/
$ mkdir old_system
$ mv * .* old_system
```

実行していることは単純で、**メインの起動ディスクに移動 → ディレクトリを作成 → 全ファイルをそこに移動** という感じ。3行目はバッククォートとシングルクォーテーションの違いに気をつけてください。

#### 手順3

あとはターミナルを終了して普通にインストールプロセスを開始。インストール後は起動ディスク直下にold_systemというフォルダができてるので、そこから不要なファイルを消したり、必要なデータを新システムに持ってきたりすればいい。

#### 所感

- Snow Leopardの頃からやってて今まで特に不具合はないですが、自己責任でおねがいします。特にrootでシェルに入るので慎重に。
- Mountain Lionを使ってみて、一番嬉しかったのはMail.appのルールがiCloud経由で同期してくれること。あとiMessage便利すぎ。
-  3行目は最初 `mv $(ls -A -I 'old_system') old_system` とか考えてみたものの、DarwinにはGNU lsが入っていなくて -A も -I も使えなかったから普通にmvしてる。

#### 141024 追記

Yosemiteがでましたね。ls -A が行けるようになったぽいので、@k_teru 氏の知見をもとに

```bash
$ cd /Volumes/Macintosh\ HD/
$ FILES=$(ls -A) &amp;&amp; mkdir old &amp;&amp; mv ${FILES} old
```

としてみてはどうかなと。
