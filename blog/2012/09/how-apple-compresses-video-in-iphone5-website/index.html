<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>要約 : Apple iPhone5のページのJPEGとJSとcanvasタグによるビデオの実装がやばいという話 - lowply.github.io</title>
	<meta name="description" content="">
	<meta name="author" content="lowply">
	<meta name="generator" content="Hugo 0.57.2" />
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="lowply" />
	<meta name="twitter:title" content="要約 : Apple iPhone5のページのJPEGとJSとcanvasタグによるビデオの実装がやばいという話 - lowply.github.io">
	<meta name="twitter:description" content="">
	<meta property="fb:app_id" content="1612273492388081">
	<meta property="og:type" content="article">
	<meta property="og:title" content="要約 : Apple iPhone5のページのJPEGとJSとcanvasタグによるビデオの実装がやばいという話 - lowply.github.io">
	<meta property="og:url" content="https://lowply.github.io/blog/2012/09/how-apple-compresses-video-in-iphone5-website/"/>
	<meta property="og:image" content="http://lowply.github.io/assets/img/og.png"/>
	<meta property="og:description" content="">
	<link rel="shortcut icon" href="/favicon.ico">
	<link rel="alternate" type="application/rss+xml" title="lowply.github.io" href="/index.xml" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    
    <link href="/sass/main.min.9d855d7218281e814234308dcddf4f3a0ca32e7de12ed96c235618cc8a889b4e.css" rel="stylesheet">
</head>
<body class="blog">

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=1612273492388081";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



<div class="container article">
	<div class="row">
		<div class="col-md-2"></div>
		<div class="col-md-8">
			<h1><a href="/">lowply.github.io</a>/<a href="/blog/">blog</a></h1>
			<section class="post">
				<h2>
					要約 : Apple iPhone5のページのJPEGとJSとcanvasタグによるビデオの実装がやばいという話
				</h2>
				<article>
					

<p>2012年9月26日 追記しました。</p>

<p>要約エントリー。</p>

<p>元記事 : <a href="https://docs.google.com/document/pub?id=1GWTMLjqQsQS45FWwqNG9ztQTdGF48hQYpjQHR_d1WsI">iPhone 5 website teardown: How Apple compresses video using JPEG, JSON, and &lt;canvas&gt;</a></p>

<p><a href="http://www.apple.com/iphone/design/#animation-unlock">アップルのサイトのiPhone5のページにある「スライドしてアンロック」のアニメーション</a>が、信じられない実装になっている、という話。簡単に要約してみた。（ミスなどの指摘は <a href="https://twitter.com/lowply/">@lowply</a> までお願いします）</p>

<p>もともとh.264とWebMの動画フォーマット戦争でブラウザ互換性の問題がまだ残っている上、iPhoneなどは「再生ボタン」を押さないと再生できなかったりするので、こうした短いアニメーションにvideoタグを使うことは最適解ではなかったらしい。</p>

<p>そこで発想の転換をして、<a href="http://www.apple.com/macbook-pro/features/#seq">Retina MBPのページ</a>では、蓋が開くたった2秒間のアニメーションに60枚のJPGをぶん回すという荒業を使っていた。これは実に5MBもの画像を使っていることになる（そのかわりRetinaディスプレイに対応した画像サイズにはなっていない）↓ これ。</p>

<p><img src="/images/2012/09/open_060.jpg" width="100%" /></p>

<p>で、今回のiPhone5のアンロックアニメーションは更に手法を更に進化させて、1MBに収まる2枚のJPG画像をJSで高速に差し替えてcanvasタグ内に描画している。各フレームごとのJPGの位置はJSONで記述されていて、全体的な制御は ac_flow.js が行なっていると。圧縮されたJPG画像はこんな感じ。注：バグってるわけではありません。元画像は<a href="http://www.apple.com/iphone/design/images/unlock/unlock_001.jpg">こちら</a></p>

<p><img src="/images/2012/09/unlock_001.jpg" width="100%" /></p>

<p>ここまで来ると誰にも真似できないというか、驚きを通り越して恐怖。昔から思ってたけど、Appleのウェブサイトって本当に一つの目指すべき姿だと思う。</p>

<p>元記事にはより技術的な詳細や、EarPodsのQTVR的な動きの実装についても言及されているので、すべてのUI/UXデザインに関わる人にとって一読の価値ありかと。</p>

<h4 id="2012年9月26日-追記">2012年9月26日 追記</h4>

<p>昨夜、この記事がFICCの<a href="https://twitter.com/akirafukuoka">@akirafukuoka</a>さんに紹介され、さらに尊敬する<a href="https://twitter.com/fladdict">@fladdict</a>さんにRTされた形で一気に拡散し、<a href="http://b.hatena.ne.jp/hotentry">ホットエントリー入り</a>しました。まさか自分のVPSが最大瞬間7.5Mbpsのトラフィックを出すとは思ってもいなかったです。</p>

<p><img src="/images/2012/09/if_eth0-day.png" width="100%" /></p>

<p>感動して勢いで書いた部分もあり、読み返して表現が間違ってるなーと思う部分もあったので訂正しつつ追記。</p>

<h4 id="各方面のコメント">各方面のコメント</h4>

<p>はてブ
<a href="http://b.hatena.ne.jp/entry/fixture.jp/blog/2012/09/how-apple-compresses-video-in-iphone5-website/">http://b.hatena.ne.jp/entry/fixture.jp/blog/2012/09/how-apple-compresses-video-in-iphone5-website/</a></p>

<p>Twitter
<a href="https://twitter.com/i/#!/search/?q=fixture.jp">https://twitter.com/i/#!/search/?q=fixture.jp</a></p>

<p>一番見かけたのが「こんなん目指すべき姿じゃない」というご意見。</p>

<blockquote>
<p>アホ言え! 一番真似しちゃアカンタイプのバッドノウハウの塊やないかい!!
こんなん目指してどうするんだよ。こういう事やらなくて良い世界目指す方でおねがいします。
まずSafariでインライン再生できるようにするのが先じゃないのか</p>
</blockquote>

<p>バッドかどうかは後述するとして、このノウハウそのものが「目指すべき姿」だとは思っていないのですが、言葉足らずでした。スミマセン。</p>

<p>ここで書きたかったことは、この10年Appleのサイトを見てきて一度も「大規模リニューアル」とかをせず、新製品が登場するごとに部分的に変化し、HTML5, JS, CSSを使って新しい技術を積極的に取り入れながら、まるで生き物のように成長していく全体的なサイト運営手法が、大規模オフィシャルサイトのひとつの「目指すべき姿」だと感じたということです。これは昔から思っていたことです。</p>

<p><a href="/blog/2007/08/how-apple-uses-css-ir-on-their-globalmenu/">Appleサイトに見るグローバルメニューの画像置換手法 | fixture.jp</a></p>

<p>ウェブ上での表現、特にモーションがあるものに関してはFlashからJSへの過渡期であったり、まだまだ模索段階だと思います。だから、一つの技法を編み出して、それを大規模サイトに躊躇なく投入していく実験的な姿勢が、次の時代の流れを作っていくのではないかと思っています。そういう意味で、今はバッドノウハウでも、やがて最適化されて未来の標準技術になっていく可能性は大いにあると思います。AJAXのように。</p>

<blockquote>
<p>これがバッドノウハウを使わないと実装できないのなら、間違ってるのは仕様の方です。実装は結果のためにあるのであって、逆ではありません。</p>
</blockquote>

<p>MotionJPEGが普及しなかったように、実装と仕様には常にタイミングの問題が絡みついてきますね。</p>

<p>あと次に見かけて驚いたのが、実は昔からある技法ということ。</p>

<blockquote>
<p>ぜんぜん違うけど何となくMSX時代の裏ページに置く展開前の超圧縮画像を思い出した
変態というか、8ビット時代のプログラミングって感じだな。
昔ながらのビデオプログラミングのやり方をHTML5流で。
古典的な技術の昇華がすごい。</p>
</blockquote>

<p>リソースが少なかった頃のレトロゲーム時代によくこういう実装をしていた、ということ。なるほど先人の知恵が細い3G回線とモバイルデバイスの環境でまた生きてくるわけですねー。ダブルバッファリングという単語も見かけましたが、ちょっと詳しくは調べきれていません。</p>

<blockquote>
<p>技術的にはすごいんだろうけど開いたらCPU使用率MAXになったので結果的にはイケてないサイトになってる</p>
</blockquote>

<p>これはスゴイ嫌ですね。昔のFlashサイトはこういうことよくありました。ただ今回の例では、自分の環境ではCPUは一瞬上がるだけで特に問題ないように思いました。</p>

<p>あと、いま話題の<a href="http://branch.com/">Branch</a>にて、僕も大好きなエディタ「Sublime Text」のサイトでも同じ事やってるよ、という記事。by ONO TAKEHIKO氏。</p>

<p><a href="http://branch.com/b/apple-iphone5-jpeg-js-canvas">「Apple iPhone5のページのJPEGとJSとcanvasタグによるビデオの実装」の実装方法</a></p>

<blockquote>
<p>アップルがやっていることを、実はSublime Textのサイトでもやっていて、解説と共に圧縮画像とタイムラインJSファイルの書き出し用エンコーダが公開されています。</p>
</blockquote>

<p>そうだったんですねー。エンコーダも公開されているし。</p>

<p>最後に、今回の元記事を見つけたのは、元Tumblrの開発者で<a href="http://www.instapaper.com/">Instapaper</a>の作者でスーパーテックオタクのMarcoのブログの<a href="http://www.marco.org/2012/09/18/apple-json-video-compression">この記事</a>。いつも最先端のネタをポストしてくれるので要チェックです。</p>

				</article>
			</section>
			<nav>
				<ul class="pagination pagination-sm justify-content-center">
					<li class="page-item"><a class="page-link" href="/blog/2012/08/patch-to-disable-molokai-bgcolor/">Prev</a></li>
					<li class="page-item"><a class="page-link" href="/blog/2012/11/how-to-connect-kindle-paperwhite-to-wifi/">Next</a></li>
				</ul>
			</nav>
			
			<div class="share">
	<div class="fb-like" data-href="https://lowply.github.io/blog/2012/09/how-apple-compresses-video-in-iphone5-website/" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>

	<script>
		window.twttr = (function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0],
			t = window.twttr || {};
		if (d.getElementById(id)) return t;
		js = d.createElement(s);
		js.id = id;
		js.src = "https://platform.twitter.com/widgets.js";
		fjs.parentNode.insertBefore(js, fjs);
		
		t._e = [];
		t.ready = function(f) {
			t._e.push(f);
		};
		return t;
		}(document, "script", "twitter-wjs"));
	</script>
	<div class="twitter-share">
		<a class="twitter-share-button" href="https://twitter.com/intent/tweet">Tweet</a>
	</div>
	<div class="hb-button">
		<a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="Add to hatena bookmark">
		<img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="Add to hatena bookmark" width="20" height="20" style="border: none;" /></a>
		<script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
	</div>
	<div class="hb-button old">
		<small>Old URL bookmarks: <a href="/blog/2012/09/how-apple-compresses-video-in-iphone5-website/"></a></small>
	</div>
</div>

			<footer class="clearfix">
	<div class="postmeta">
		Written on <time datetime="2012-09-19">19 Sep, 2012</time>
		 under <a class="post-category" href="/categories/tech/">Tech</a>
	</div>
	<div class="float-xs-left">
		Generated by <a href="https://gohugo.io/">Hugo</a> 0.57.2 and hosted by <a href="https://pages.github.com/">GitHub Pages</a>.
	</div>
	<div class="float-xs-right">
		<i class="fa fa-rss"></i> <a href="/index.xml">Feed</a>
	</div>
</footer>

		</div>
		<div class="col-md-2"></div>
	</div>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script src="https://use.fontawesome.com/662ce5e241.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>

<script src="/js/main.min.142d91a69dd6e1d149a1047928e0e29998c121a41270c2049e644ba271848fef.js"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-258121-9', 'auto');
ga('send', 'pageview');

</script>


</body>
</html>



